#!/usr/bin/env node
(()=>{var e={182:(e,t,s)=>{const r=s(17).join(process.cwd()),o=s(499),n=s(475);e.exports={port:n,IPs:o,hostUrl:`http://${o[0]}:${n}`,sharedPath:r}},295:(e,t,s)=>{const r=s(615),o=s(17),{sharedPath:n}=s(182),a=n.split(o.sep).join("/");e.exports=function(e,t){let s=!1;const o=r(n,{attributes:["size","type","extension"],normalizePath:!0},((e,t,s)=>{e.download=e.path.replace(a,"")}));o.path&&(s=!0),o.success=s,t.send(o)}},413:(e,t,s)=>{const r=s(860).Router(),{hostUrl:o}=s(182),{getSocketHistory:n}=s(798),a=s(295),c=s(117),i=s(81).exec,p=s(37).platform();r.post("/list",a),r.post("/upload",c),r.post("/host",((e,t)=>{t.send({host:o,shutdown:"win32"===p})})),r.post("/download",((e,t,s)=>{const r=e.query;try{t.download(r.file,r.fileName)}catch(e){t.stats(400).send("download error")}})),r.post("/talk_history",((e,t)=>{t.send({list:n(),success:!0})})),r.post("/shutdown",((e,t)=>{setTimeout((()=>i("shutdown -s")),0),t.send({})})),e.exports=r},117:(e,t,s)=>{const r=s(147),o=s(17),n=s(165),{sharedPath:a}=s(182);e.exports=function(e,t){let s=!1;const c={uploadDir:a},i=new n.Form(c);i.parse(e,((e,n,a)=>{try{const c=n.dir[0];if(e||!c)return void t.send({err:e,success:s});a.upload.forEach((e=>{const t=o.format({dir:c,base:e.originalFilename}),s=function(e,t){let s=!0,n=0;const{dir:a,ext:c}=o.parse(e);for(;s;)if(r.existsSync(e)){const s=t+ ++n+c;e=o.format({dir:a,base:s})}else s=!1;return e}(t,o.parse(t).name);r.renameSync(e.path,s)})),s=!0}catch(e){s=!1}s&&t.send({success:s,fields:n,files:a})})),i.on("error",(e=>{t.send({err:e,success:s})}))}},798:(e,t,s)=>{const r={},o=[];let n=0;function a(){return(new Date).getTime()}e.exports={socket:{listen:function(e){s(952)(e).on("connection",(e=>function(e){e.emit("open");var t={socket:e,name:!1};e.on("chat message",(function(s){var c={time:a()};t.name?(c.text=s,c.author=t.name,c.type="message",e.emit("chat message",c),e.broadcast.emit("chat message",c),o.push(c)):(n++,t.name=s,c.text=t.name,c.author="Sys",c.type="welcome",c.onlineUserCount=n,e.name=t.name,r.hasOwnProperty(t.name)||(r[t.name]=t.name),c.onlineUsers=r,e.emit("system",c),e.broadcast.emit("system",c))})),e.on("disconnect",(function(){n--,r.hasOwnProperty(e.name)&&delete r[t.name];var s={time:a(),author:"Sys",text:t.name,type:"disconnect",onlineUserCount:n,onlineUsers:r};e.broadcast.emit("system",s)}))}(e)))}},getSocketHistory:function(){return o}}},499:(e,t,s)=>{const r=s(37).networkInterfaces(),o=[];try{for(const e of Object.keys(r))for(const t of r[e]){const{address:e,family:s,internal:r}=t;"IPv4"!==s||r||o.push(e)}}catch(e){}e.exports=o},475:e=>{const t=process.argv.reverse();let s=6200;if(t.length<=3)for(let e=0;e<t.length;e++){const r=Number(t[e]);if(r&&r>20&&r<65535){s=r;break}}e.exports=s},615:e=>{"use strict";e.exports=require("directory-tree")},860:e=>{"use strict";e.exports=require("express")},165:e=>{"use strict";e.exports=require("multiparty")},952:e=>{"use strict";e.exports=require("socket.io")},81:e=>{"use strict";e.exports=require("child_process")},147:e=>{"use strict";e.exports=require("fs")},685:e=>{"use strict";e.exports=require("http")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}(()=>{const e=s(860),t=s(17),{socket:r}=s(798),{sharedPath:o,IPs:n,port:a}=s(182),c=e(),i=s(685).Server(c),p=t.join(__dirname,"web");r.listen(i),c.use("/api",s(413)),c.use(e.static(p)),c.use(e.static(o)),i.listen(a,(()=>{console.log("http://localhost:"+a),n.forEach((e=>{console.log(`http://${e}:${a}`)}))}))})()})();