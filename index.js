#!/usr/bin/env node
(()=>{var e={182:(e,t,s)=>{const r=s(622).join(process.cwd()),o=s(499),n=s(475);e.exports={port:n,IPs:o,hostUrl:`http://${o[0]}:${n}`,sharedPath:r}},295:(e,t,s)=>{const r=s(597),o=s(622),{sharedPath:n}=s(182),c=n.split(o.sep).join("/");e.exports=function(e,t){let s=!1;const o=r(n,{normalizePath:!0},((e,t,s)=>{e.download=e.path.replace(c,"")}));o.path&&(s=!0),o.success=s,t.send(o)}},413:(e,t,s)=>{const r=s(127).Router(),{hostUrl:o}=s(182),{getSocketHistory:n}=s(798),c=s(295),a=s(117),i=s(129).exec,p=s(87).platform();r.post("/list",c),r.post("/upload",a),r.post("/host",((e,t)=>{t.send({host:o,shutdown:"win32"===p})})),r.post("/download",((e,t,s)=>{const r=e.query;try{t.download(r.file,r.fileName)}catch(e){t.stats(400).send("download error")}})),r.post("/talk_history",((e,t)=>{t.send({list:n(),success:!0})})),r.post("/shutdown",((e,t)=>{setTimeout((()=>i("shutdown -s")),0),t.send({})})),e.exports=r},117:(e,t,s)=>{const r=s(747),o=s(622),n=s(758),{sharedPath:c}=s(182);e.exports=function(e,t){let s=!1;const a={uploadDir:c},i=new n.Form(a);i.parse(e,((e,n,c)=>{try{const a=n.dir[0];if(e||!a)return void t.send({err:e,success:s});c.upload.forEach((e=>{const t=o.format({dir:a,base:e.originalFilename}),s=function(e,t){let s=!0,n=0;const{dir:c,ext:a}=o.parse(e);for(;s;)if(r.existsSync(e)){const s=t+ ++n+a;e=o.format({dir:c,base:s})}else s=!1;return e}(t,o.parse(t).name);r.renameSync(e.path,s)})),s=!0}catch(e){s=!1}s&&t.send({success:s,fields:n,files:c})})),i.on("error",(e=>{t.send({err:e,success:s})}))}},798:(e,t,s)=>{const r={},o=[];let n=0;function c(){return(new Date).getTime()}e.exports={socket:{listen:function(e){s(395)(e).on("connection",(e=>function(e){e.emit("open");var t={socket:e,name:!1};e.on("chat message",(function(s){var a={time:c()};t.name?(a.text=s,a.author=t.name,a.type="message",e.emit("chat message",a),e.broadcast.emit("chat message",a),o.push(a)):(n++,t.name=s,a.text=t.name,a.author="Sys",a.type="welcome",a.onlineUserCount=n,e.name=t.name,r.hasOwnProperty(t.name)||(r[t.name]=t.name),a.onlineUsers=r,e.emit("system",a),e.broadcast.emit("system",a))})),e.on("disconnect",(function(){n--,r.hasOwnProperty(e.name)&&delete r[t.name];var s={time:c(),author:"Sys",text:t.name,type:"disconnect",onlineUserCount:n,onlineUsers:r};e.broadcast.emit("system",s)}))}(e)))}},getSocketHistory:function(){return o}}},499:(e,t,s)=>{const r=s(87).networkInterfaces(),o=[];try{for(const e of Object.keys(r))for(const t of r[e]){const{address:e,family:s,internal:r}=t;"IPv4"!==s||r||o.push(e)}}catch(e){}e.exports=o},475:e=>{const t=process.argv.reverse();let s=6200;if(t.length<=3)for(let e=0;e<t.length;e++){const r=Number(t[e]);if(r&&r>20&&r<65535){s=r;break}}e.exports=s},129:e=>{"use strict";e.exports=require("child_process")},597:e=>{"use strict";e.exports=require("directory-tree")},127:e=>{"use strict";e.exports=require("express")},747:e=>{"use strict";e.exports=require("fs")},605:e=>{"use strict";e.exports=require("http")},758:e=>{"use strict";e.exports=require("multiparty")},87:e=>{"use strict";e.exports=require("os")},622:e=>{"use strict";e.exports=require("path")},395:e=>{"use strict";e.exports=require("socket.io")}},t={};function s(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}(()=>{const e=s(127),t=s(622),{socket:r}=s(798),{sharedPath:o,IPs:n,port:c}=s(182),a=e(),i=s(605).Server(a),p=t.join(__dirname,"web");r.listen(i),a.use("/api",s(413)),a.use(e.static(p)),a.use(e.static(o)),i.listen(c,(()=>{console.log("http://localhost:"+c),n.forEach((e=>{console.log(`http://${e}:${c}`)}))}))})()})();